<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="order_record">
    <typeAlias alias="orderRecordDO" type="com.mockuai.marketingcenter.core.domain.OrderRecordDO"/>

    <resultMap id="BaseResultMap" class="com.mockuai.marketingcenter.core.domain.OrderRecordDO">
        <result column="id" property="id" jdbcType="BIGINT"/>
        <result column="activity_id" property="activityId" jdbcType="BIGINT"/>
        <result column="order_id" property="orderId" jdbcType="BIGINT"/>
        <result column="user_id" property="userId" jdbcType="BIGINT"/>
        <result column="delete_mark" property="deleteMark" jdbcType="TINYINT"/>
        <result column="gmt_created" property="gmtCreated" jdbcType="TIMESTAMP"/>
        <result column="gmt_modified" property="gmtModified" jdbcType="TIMESTAMP"/>
    </resultMap>
    <sql id="Base_Column_List">
        id, activity_id, order_id, user_id,delete_mark, gmt_created, gmt_modified
    </sql>
    <insert id="addOrderRecord" parameterClass="com.mockuai.marketingcenter.core.domain.OrderRecordDO">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Jul 18 15:38:18 CST 2016.
        -->
        insert into order_record (activity_id, order_id, user_id, delete_mark, gmt_created,
        gmt_modified)
        values ( #activityId:BIGINT#, #orderId:BIGINT#, #userId:BIGINT#, 0,now(), now())
        <selectKey resultClass="java.lang.Long" keyProperty="id">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <sql id="queryWhere">
        where delete_mark=0
        <isNotNull prepend="and" property="activityId">
            activity_id=#activityId#
        </isNotNull>
    </sql>

    <select id="queryOrderRecord" resultMap="BaseResultMap"
            parameterClass="com.mockuai.marketingcenter.common.domain.qto.OrderRecordQTO">
        select
        <include refid="order_record.Base_Column_List"/>
        from order_record
        <include refid="order_record.queryWhere"/>
        order by id DESC
        <isNotNull prepend="limit" property="count">
            #offset:INTEGER#,#count:INTEGER#
        </isNotNull>
    </select>

    <select id="countOfQueryOrderRecord" resultClass="java.lang.Integer"
            parameterClass="com.mockuai.marketingcenter.common.domain.qto.OrderRecordQTO">
        select count(1) from order_record
        <include refid="order_record.queryWhere"/>
    </select>
</sqlMap>